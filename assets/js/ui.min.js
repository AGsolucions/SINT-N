import{EXTENDED_FIELDS as e}from"./config_extended.js";import{refreshMapData as t}from"./map.js";import{PARROQUIAS_POR_CANTON as n}from"./config_extended.js";const a="sintnu.sidebar.order",l="sintnu.sidebar.collapse";function o(){try{return JSON.parse(localStorage.getItem(l))||{}}catch{return{}}}export function renderFilters(){const c={};for(const t of e){const e=t.section||"Otros";c[e]||(c[e]=[]),c[e].push(t)}let r=Object.keys(c);const s=function(){try{return JSON.parse(localStorage.getItem(a))||[]}catch{return[]}}();if(s.length){const e=new Set(s);r=[...s,...r.filter(t=>!e.has(t))]}const d=o(),i=document.getElementById("sidebar");i.innerHTML="",r.forEach(e=>{const n=document.createElement("div");n.className="section",n.setAttribute("draggable","true"),n.dataset.section=e;const a=document.createElement("div");a.className="title",a.innerHTML=`\n      <span class="grip" aria-hidden="true">⋮⋮</span>\n      <span class="t-text">${e}</span>\n      <span class="t-arrow" aria-hidden="true">▾</span>\n    `,n.appendChild(a);const r=document.createElement("div");r.className="content",c[e].forEach(e=>{const n=document.createElement("div");n.className="row";const a=document.createElement("label");let l;a.setAttribute("for",e.id),a.textContent=e.label,"text"===e.type||"number"===e.type?(l=document.createElement("input"),l.type=e.type,l.id=e.id):"select"===e.type?(l=document.createElement("select"),l.id=e.id,(e.options||[{value:"__all__",label:"Todos"}]).forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,l.appendChild(t)}),l.querySelector('option[value="__all__"]')&&(l.value="__all__")):"multiselect"===e.type?(l=document.createElement("select"),l.id=e.id,l.multiple=!0,(e.options||[]).forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,l.appendChild(t)})):"boolean"===e.type?(l=document.createElement("select"),l.id=e.id,[{value:"__all__",label:"Todos"},{value:"true",label:"Sí"},{value:"false",label:"No"}].forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,l.appendChild(t)}),l.value="__all__"):(l=document.createElement("input"),l.type="text",l.id=e.id),l.addEventListener("change",()=>t()),n.appendChild(a),n.appendChild(l),r.appendChild(n)});!!d[e]&&(n.classList.add("collapsed"),r.style.display="none"),n.appendChild(r),i.appendChild(n),a.addEventListener("click",t=>{if(0===t.detail)return;const a=n.classList.toggle("collapsed");r.style.display=a?"none":"block";const c=o();var s;c[e]=a?1:0,s=c,localStorage.setItem(l,JSON.stringify(s))})});const u=document.getElementById("f_canton"),p=document.getElementById("f_parroquia");function m(e){const t=n[e]||[];if(p.innerHTML="",!t.length){const e=document.createElement("option");return e.value="",e.textContent="No se encontraron datos",void p.appendChild(e)}const a=document.createElement("option");a.value="__all__",a.textContent="Todas",p.appendChild(a),t.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,p.appendChild(t)}),p.value="__all__"}u&&p&&(m(u.value),u.addEventListener("change",()=>{m(u.value),p.dispatchEvent(new Event("change"))})),function(){const e=document.getElementById("sidebar"),t=Array.from(e.querySelectorAll(".section"));let n=null;t.forEach(t=>{t.addEventListener("dragstart",e=>{n=t,t.classList.add("dragging"),e.dataTransfer.effectAllowed="move";const a=new Image;a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBA==",e.dataTransfer.setDragImage(a,0,0)}),t.addEventListener("dragend",()=>{n&&n.classList.remove("dragging"),n=null;const t=Array.from(e.querySelectorAll(".section")).map(e=>e.dataset.section);var l;l=t,localStorage.setItem(a,JSON.stringify(l))})}),e.addEventListener("dragover",t=>{t.preventDefault();const a=function(e,t){const n=[...e.querySelectorAll(".section:not(.dragging)")];let a=null,l=Number.NEGATIVE_INFINITY;return n.forEach(e=>{const n=e.getBoundingClientRect(),o=t-n.top-n.height/2;o<0&&o>l&&(l=o,a=e)}),a}(e,t.clientY);n&&(null==a?e.appendChild(n):e.insertBefore(n,a))})}()}