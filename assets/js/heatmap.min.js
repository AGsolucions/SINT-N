import{getRawData as e,getMapInstance as t,updateExternalFilters as o}from"./map.min.js";import{parseCoordsText as a}from"./utils.min.js";let n=null;export function initHeatmap(){n=new maplibregl.Map({container:"miniHeatmap",style:{version:8,glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",sources:{"osm-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm-tiles"}]},center:t()?.getCenter()||[-78.619,-1.25],zoom:11}),n.addControl(new maplibregl.NavigationControl,"top-right"),n.on("load",()=>{n.addSource("negocios-mini",{type:"geojson",data:e()||{type:"FeatureCollection",features:[]}}),n.addLayer({id:"heat",type:"heatmap",source:"negocios-mini",paint:{"heatmap-weight":1,"heatmap-intensity":1,"heatmap-radius":18,"heatmap-opacity":.85}}),n.on("click",e=>{const o=t();o&&o.easeTo({center:e.lngLat,zoom:Math.max(o.getZoom(),14)})})});document.getElementById("polyForm").addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("polyCoords").value,n=document.getElementById("polyMode").value,i=a(t);if(!i||i.length<3)return void alert("Coordenadas inválidas. Formato: lon,lat; lon,lat; ...");const r={type:"Feature",geometry:{type:"Polygon",coordinates:[i.concat([i[0]])]},properties:{}};o({polygon:r,polygonMode:n})})}export function refreshMiniHeat(){if(!n)return;const t=n.getSource("negocios-mini");t&&t.setData(e()||{type:"FeatureCollection",features:[]})}
